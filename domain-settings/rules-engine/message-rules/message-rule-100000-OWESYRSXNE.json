{"type":2,"data":{"lang":"GROOVY","code":"log.info(\"%s\",util.toJson(msg));\n\nPARKING_LOT_MASTER = 2001;\nPARKING_LOT_HISTORY = 2002;\n\ndef statusObj = [status:false];\n\ntry {\n    if(msg){\n\n        //log.warn('1MESSAGE---Lot Id => %s', msg.lot);\n        \n        def devMasterStsData = [:];\n        \n        def lot_obj = record.search(PARKING_LOT_MASTER, '{ \"query\": { \"bool\": { \"must\": [ { \"match\": { \"domainKey\": \"'+msg.domainkey+'\" } }, { \"match\": { \"lot_sid\": \"'+msg.lot+'\" }}, { \"match\": { \"garage_name\": \"'+msg.garage+'\" }} ] } }, \"sort\": [{ \"updated_time\": {\"order\": \"desc\"}}], \"size\": 1000, \"from\": 0 }');\n            //log.warn('3MESSAGE---Lot Id => %s', lot_obj);\n            lot_obj = lot_obj.get('hits').get('hits');\n            \n        if(lot_obj.size()){\n            def lotUniqId =  lot_obj.get(0)._id;\n            lot_obj = lot_obj.get(0).get('_source');\n            \n            def updatedLotData = [:];\n            \n            updatedLotData[\"gwid\"] = lot_obj[\"gwid\"];\n            updatedLotData[\"garage_id\"] = lot_obj[\"garage_id\"];\n            updatedLotData[\"garage_name\"] = lot_obj[\"garage_name\"];\n            updatedLotData[\"distance\"] = msg.distance;\n            updatedLotData[\"lot_sid\"] = lot_obj[\"lot_sid\"];\n            updatedLotData[\"updated_by\"] = lot_obj[\"updated_by\"];\n            updatedLotData[\"created_by\"] = lot_obj[\"created_by\"];\n            updatedLotData[\"updated_time\"] = util.millis();\n            updatedLotData[\"created_time\"] = util.millis();\n            \n            //log.info(\"Data -> %s\",updatedLotData)\n                \n            record.insert(PARKING_LOT_MASTER, lotUniqId , updatedLotData);\n            record.insert(PARKING_LOT_HISTORY, updatedLotData);\n            \n            statusObj[\"status\"] = true;\n            statusObj[\"status\"] = updatedLotData;\n        }\n    }\n}\ncatch(Exception ex){\n    \n  def ermsg = util.toString(ex);\n  failure.insert(ermsg);\n  \n    statusObj['error'] = ermsg;\n    //log.error(\"Status Message: => %s,\",ermsg)\n    \n}\nfinally{\n\n    //log.info(\"statusObj %s\",statusObj);\n    return statusObj;\n}\n","messageId":100000}}